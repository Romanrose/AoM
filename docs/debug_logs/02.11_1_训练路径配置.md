# AoMé¡¹ç›®è®­ç»ƒè·¯å¾„é…ç½®

## ğŸ“‚ è·¯å¾„é…ç½®æ€»è§ˆ

### global_var.py ä¸­å®šä¹‰çš„è·¯å¾„

#### 1. åŸºç¡€è·¯å¾„
```python
root_dir = './'                    # é¡¹ç›®æ ¹ç›®å½•
src_dir = './src/'                # æºä»£ç ç›®å½•
config_dir = './configs/'          # é…ç½®æ–‡ä»¶ç›®å½•
pretrain_dir = './pretrain/'       # é¢„è®­ç»ƒæ¨¡å‹ç›®å½•
```

#### 2. è®­ç»ƒè¾“å‡ºè·¯å¾„
```python
log_dir = './logs/'               # TensorBoardæ—¥å¿—ç›®å½•
result_dir = './results/'          # ç»“æœè¾“å‡ºç›®å½•
record_dir = './records/'          # è®­ç»ƒè®°å½•ç›®å½•
checkpoint_dir = './checkpoints/'  # æ£€æŸ¥ç‚¹ç›®å½•
```

#### 3. ç»Ÿä¸€è®­ç»ƒæ£€æŸ¥ç‚¹è·¯å¾„
```python
# ç»Ÿä¸€æ£€æŸ¥ç‚¹ç›®å½• (æ‰€æœ‰ä»»åŠ¡)
train15_ckpt_dir = './checkpoints/train_15/'      # Twitter15è®­ç»ƒæ£€æŸ¥ç‚¹
train17_ckpt_dir = './checkpoints/train_17/'      # Twitter17è®­ç»ƒæ£€æŸ¥ç‚¹
train_trc_ckpt_dir = './checkpoints/train_trc/'   # TRCé¢„è®­ç»ƒæ£€æŸ¥ç‚¹

# ç»Ÿä¸€æ—¥å¿—ç›®å½•è·¯å¾„
twitter15_log_dir = './logs/aom_twitter15_logs/'  # Twitter15ä¸“ç”¨æ—¥å¿—
twitter17_log_dir = './logs/aom_twitter17_logs/'  # Twitter17ä¸“ç”¨æ—¥å¿—
```

---

## ğŸ“Š å®é™…è·¯å¾„ä½¿ç”¨æƒ…å†µ

### 1. è®­ç»ƒæ£€æŸ¥ç‚¹è·¯å¾„

| ä»»åŠ¡ç±»å‹ | æ£€æŸ¥ç‚¹è·¯å¾„ | ç¤ºä¾‹ |
|----------|------------|------|
| Twitter15 | `./checkpoints/train_15/YYYY-MM-DD-HH-MM-SS/` | `./checkpoints/train_15/2026-01-11-17-35-49/` |
| Twitter17 | `./checkpoints/train_17/YYYY-MM-DD-HH-MM-SS/` | `./checkpoints/train_17/2026-01-11-17-35-49/` |
| TRCé¢„è®­ç»ƒ | `./checkpoints/train_trc/YYYY-MM-DD-HH-MM-SS/` | `./checkpoints/train_trc/2026-01-11-17-35-49/` |

### 2. æ—¥å¿—è·¯å¾„

| æ—¥å¿—ç±»å‹ | è·¯å¾„æ ¼å¼ | ç¤ºä¾‹ |
|----------|----------|------|
| Twitter15æ—¥å¿— | `./logs/aom_twitter15_logs/YYYY-MM-DD-HH-MM-SS/` | `./logs/aom_twitter15_logs/2026-01-11-17-35-49/` |
| Twitter17æ—¥å¿— | `./logs/aom_twitter17_logs/YYYY-MM-DD-HH-MM-SS/` | `./logs/aom_twitter17_logs/2026-01-11-17-35-49/` |
| TRCæ—¥å¿— | `./logs/YYYY-MM-DD-HH-MM-SS/` | `./logs/2026-01-11-17-35-49/` |

### 3. æ¨¡å‹ä¿å­˜è·¯å¾„

```python
# æ£€æŸ¥ç‚¹ä¿å­˜
checkpoint_path = os.path.join(args.checkpoint_dir, timestamp)

# æ—¥å¿—ç›®å½•
log_dir = os.path.join(args.log_dir, timestamp)

# æ—¥å¿—æ–‡ä»¶
log_file = os.path.join(log_dir, 'log.txt')
```

---

## ğŸ”§ run_aom.py ä¸­çš„è·¯å¾„è®¾ç½®

### é»˜è®¤è·¯å¾„
```python
# æ£€æŸ¥ç‚¹ç›®å½•
'--checkpoint_dir', 'checkpoints'

# æ—¥å¿—ç›®å½•
'--log_dir', 'logs'
```

### ä»»åŠ¡ç‰¹å®šè·¯å¾„

#### Twitter15
```python
# æ£€æŸ¥ç‚¹ (ç»Ÿä¸€è·¯å¾„)
cmd_args.extend(['--checkpoint_dir', train15_ckpt_dir])
# å®é™…è·¯å¾„: './checkpoints/train_15/'

# æ—¥å¿— (ç»Ÿä¸€åˆ° logs/ ä¸‹)
if args.log_dir == 'logs':
    args.log_dir = twitter15_log_dir
# å®é™…è·¯å¾„: './logs/aom_twitter15_logs/'
```

#### Twitter17
```python
# æ£€æŸ¥ç‚¹ (ç»Ÿä¸€è·¯å¾„)
cmd_args.extend(['--checkpoint_dir', train17_ckpt_dir])
# å®é™…è·¯å¾„: './checkpoints/train_17/'

# æ—¥å¿— (ç»Ÿä¸€åˆ° logs/ ä¸‹)
if args.log_dir == 'logs':
    args.log_dir = twitter17_log_dir
# å®é™…è·¯å¾„: './logs/aom_twitter17_logs/'
```

#### TRCé¢„è®­ç»ƒ
```python
# æ£€æŸ¥ç‚¹ (ç»Ÿä¸€è·¯å¾„)
cmd_args.extend(['--checkpoint_dir', train_trc_ckpt_dir])
# å®é™…è·¯å¾„: './checkpoints/train_trc/'

# æ—¥å¿—
# log_dir: 'logs'
```

---

## ğŸ“ ç›®å½•ç»“æ„

```
/data/ljy/media/projects/aom/
â”œâ”€â”€ checkpoints/              # ç»Ÿä¸€æ£€æŸ¥ç‚¹ç›®å½•
â”‚   â”œâ”€â”€ train_15/            # Twitter15è®­ç»ƒæ£€æŸ¥ç‚¹
â”‚   â”‚   â”œâ”€â”€ 2025-11-17-18-04-35/
â”‚   â”‚   â”œâ”€â”€ 2025-11-18-21-48-00/
â”‚   â”‚   â”œâ”€â”€ ...
â”‚   â”‚   â””â”€â”€ 2026-01-11-17-35-49/
â”‚   â”œâ”€â”€ train_17/            # Twitter17è®­ç»ƒæ£€æŸ¥ç‚¹
â”‚   â”‚   â”œâ”€â”€ 2025-11-13-20-44-36/
â”‚   â”‚   â”œâ”€â”€ 2025-11-13-22-18-26/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ train_trc/           # TRCé¢„è®­ç»ƒæ£€æŸ¥ç‚¹
â”‚   â”‚   â”œâ”€â”€ 2025-11-13-20-34-04/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ pytorch_model.bin    # TRCé¢„è®­ç»ƒæ¨¡å‹
â”‚   â”œâ”€â”€ AoM-ckpt/          # AoMæ¨¡å‹æ£€æŸ¥ç‚¹
â”‚   â””â”€â”€ ...
â”œâ”€â”€ logs/                   # ç»Ÿä¸€æ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ aom_twitter15_logs/    # Twitter15ä¸“ç”¨æ—¥å¿—
â”‚   â”‚   â”œâ”€â”€ 2026-01-11-14-33-20/
â”‚   â”‚   â”œâ”€â”€ 2026-01-11-17-34-13/
â”‚   â”‚   â””â”€â”€ 2026-01-11-17-35-49/
â”‚   â”œâ”€â”€ aom_twitter17_logs/    # Twitter17ä¸“ç”¨æ—¥å¿—
â”‚   â”‚   â””â”€â”€ (ç±»ä¼¼ç»“æ„)
â”‚   â”œâ”€â”€ 2025-11-13-20-33-58/  # TRCæ—¥å¿—
â”‚   â””â”€â”€ 2025-11-13-20-34-04/  # TRCæ—¥å¿—
â”œâ”€â”€ results/                # ç»“æœè¾“å‡ºç›®å½•
â”‚   â””â”€â”€ error_analysis/     # é”™è¯¯åˆ†æç»“æœ
â””â”€â”€ records/                # è®­ç»ƒè®°å½•ç›®å½•
    â””â”€â”€ (ç©º)
```

---

## ğŸ¯ è·¯å¾„å‘½åè§„åˆ™

### 1. æ—¶é—´æˆ³æ ¼å¼
```
timestamp = datetime.now().strftime("%Y-%m-%d-%H-%M-%S")
```
**ç¤ºä¾‹**: `2026-01-11-17-35-49`

### 2. æ–‡ä»¶å‘½å
- **æ£€æŸ¥ç‚¹**: `pytorch_model.bin`, `AoM.pt`, `resnet152.pt`
- **æ—¥å¿—**: `log.txt`
- **è®­ç»ƒæ•°æ®**: `training_data.pt`

---

## ğŸ“ å…³é”®é…ç½®ç‚¹

### MAESC_training.py
```python
# æ£€æŸ¥ç‚¹è·¯å¾„
checkpoint_path = os.path.join(args.checkpoint_dir, timestamp)

# æ—¥å¿—è·¯å¾„
log_dir = os.path.join(args.log_dir, timestamp)

# ä¿å­˜æ¨¡å‹
model.seq2seq_model.save_pretrained(current_checkpoint_path)
torch.save(img_encoder, os.path.join(args.checkpoint_path, 'resnet152.pt'))
torch.save(model, os.path.join(args.checkpoint_path, 'AoM.pt'))
```

### global_update() å‡½æ•°
```python
def global_update(args):
    """è‡ªåŠ¨åˆ›å»ºç›®å½•"""
    all_dirs = [log_dir, result_dir, record_dir, checkpoint_dir,
                train15_ckpt_dir, train17_ckpt_dir, train_trc_ckpt_dir,
                twitter15_log_dir, twitter17_log_dir]
    for dir_path in all_dirs:
        if not os.path.exists(dir_path):
            os.makedirs(dir_path)
    return args
```

---

## ğŸš€ è¿è¡Œç¤ºä¾‹

### å¯åŠ¨Twitter15è®­ç»ƒ
```bash
python run_aom.py --task twitter15 --lr 7e-5 --batch_size 16
```

**å®é™…è·¯å¾„**:
- æ£€æŸ¥ç‚¹: `./checkpoints/train_15/2026-01-11-17-35-49/`
- æ—¥å¿—: `./logs/aom_twitter15_logs/2026-01-11-17-35-49/`

### å¯åŠ¨Twitter17è®­ç»ƒ
```bash
python run_aom.py --task twitter17 --lr 7e-5 --batch_size 16
```

**å®é™…è·¯å¾„**:
- æ£€æŸ¥ç‚¹: `./checkpoints/train_17/2026-01-11-17-35-49/`
- æ—¥å¿—: `./logs/aom_twitter17_logs/2026-01-11-17-35-49/`

### å¯åŠ¨TRCé¢„è®­ç»ƒ
```bash
python run_aom.py --task pretrain_trc
```

**å®é™…è·¯å¾„**:
- æ£€æŸ¥ç‚¹: `./checkpoints/train_trc/2026-01-11-17-35-49/`
- æ—¥å¿—: `./logs/2026-01-11-17-35-49/`

---

## âœ… æ€»ç»“

| ç›®å½• | ç”¨é€” | è‡ªåŠ¨åˆ›å»º |
|------|------|----------|
| `./checkpoints/` | å…¨å±€æ£€æŸ¥ç‚¹ | âœ… |
| `./checkpoints/train_15/` | Twitter15è®­ç»ƒ | âœ… |
| `./checkpoints/train_17/` | Twitter17è®­ç»ƒ | âœ… |
| `./checkpoints/train_trc/` | TRCé¢„è®­ç»ƒ | âœ… |
| `./logs/` | ç»Ÿä¸€æ—¥å¿—ç›®å½• | âœ… |
| `./logs/aom_twitter15_logs/` | Twitter15ä¸“ç”¨æ—¥å¿— | âœ… |
| `./logs/aom_twitter17_logs/` | Twitter17ä¸“ç”¨æ—¥å¿— | âœ… |
| `./results/` | ç»“æœè¾“å‡º | âœ… |
| `./records/` | è®­ç»ƒè®°å½• | âœ… |

æ‰€æœ‰è·¯å¾„éƒ½é€šè¿‡ `global_var.py` ç»Ÿä¸€ç®¡ç†ï¼Œä¾¿äºç»´æŠ¤å’Œä¿®æ”¹ã€‚

### ğŸ“Œ é‡è¦æ›´æ–° (2026-01-11 17:50)
- **æ£€æŸ¥ç‚¹è·¯å¾„ç»Ÿä¸€**: æ‰€æœ‰è®­ç»ƒä»»åŠ¡æ£€æŸ¥ç‚¹ç»Ÿä¸€å­˜å‚¨åœ¨ `./checkpoints/` ç›®å½•ä¸‹
- **ä»»åŠ¡åˆ†ç±»å­˜å‚¨**: æŒ‰ä»»åŠ¡ç±»å‹åˆ†åˆ«å­˜å‚¨åœ¨ `train_15/`, `train_17/`, `train_trc/` å­ç›®å½•
- **æ—¥å¿—è·¯å¾„ç»Ÿä¸€**: æ‰€æœ‰è®­ç»ƒæ—¥å¿—ç»Ÿä¸€å­˜å‚¨åœ¨ `./logs/` ç›®å½•ä¸‹
- **ä»»åŠ¡æ—¥å¿—åˆ†ç±»**: Twitter15/17ä¸“ç”¨æ—¥å¿—åˆ†åˆ«å­˜å‚¨åœ¨ `logs/aom_twitter15_logs/` å’Œ `logs/aom_twitter17_logs/`
- **è‡ªåŠ¨åˆ›å»º**: é€šè¿‡ `global_update()` å‡½æ•°è‡ªåŠ¨åˆ›å»ºæ‰€éœ€ç›®å½•
